<li [style.backgroundColor]="note.color || '#ffffff'" (click)="onOpen()">
  <div>
    <h3 class="note-title" title="{{ note.title }}">{{ note.title }}</h3>

    <p>{{ note.content }}</p>

    <!-- Thumbnails -->
    @if (note.images; as images) { @if (images.length) {
    <div class="image-preview">
      @for (img of images.slice(0, 3); track $index; let i = $index) {
      <!-- First two images -->
      @if (i < 2 || images.length <= 3) {
      <div class="image-wrapper">
        <img [src]="img" class="preview-thumbnail" />
      </div>
      }

      <!-- Third image with overlay if more exist -->
      @if (i === 2 && images.length > 3) {
      <div class="image-wrapper more-images-overlay">
        <img [src]="img" class="preview-thumbnail" />
        <div class="overlay">+{{ images.length - 3 }}</div>
      </div>
      } }
    </div>
    } }
  </div>

  <!-- Buttons -->
  <div class="buttons-container" (click)="$event.stopPropagation()">
    <div class="pin-icon">
      <i
        class="bi"
        [ngClass]="note.pinned ? 'bi-pin-fill' : 'bi-pin'"
        title="{{ note.pinned ? 'Unpin' : 'Pin' }}"
        (click)="onTogglePin($event)"
      ></i>
    </div>

    <!-- Hidden file input -->
    <input
      #fileInput
      type="file"
      accept="image/*"
      multiple
      style="display: none"
      (change)="onImageSelected($event)"
    />

    <!--  Feature Buttons -->
    <div class="left-buttons">
      <app-button-feature
        customClass="image-button"
        icon="mage:image"
        title="Upload image"
        (clicked)="triggerImageUpload($event)"
      ></app-button-feature>

      <app-button-feature
        customClass="add-to-notebook-button"
        icon="fluent:notebook-arrow-curve-down-20-regular"
        title="Add to notebook"
        (clicked)="openAddToNotebookModal(note)"
      ></app-button-feature>

      <app-button-feature
        customClass="reminder-button"
        icon="carbon:reminder"
        title="Add reminder"
      ></app-button-feature>

      <app-button-feature
        customClass="add-checkboxes-button"
        icon="tabler:checkbox"
        title="Add checkboxes"
        (clicked)="onDelete($event)"
      ></app-button-feature>

      <app-button-feature
        customClass="archive-button"
        icon="mage:archive"
        title="Archive note"
      ></app-button-feature>

      <!-- Conditional Delete/Remove Button -->
      @if (isInNotebook$ | async) {
      <app-button-feature
        customClass="remove-from-notebook-button"
        icon="mdi:note-remove"
        title="Remove from notebook"
        (clicked)="onRemoveFromNotebook($event)"
      ></app-button-feature>
      } @else {
      <app-button-feature
        customClass="delete-note-button"
        icon="mage:trash"
        title="Delete note"
        (clicked)="onDelete($event)"
      ></app-button-feature>
      }
    </div>
  </div>
</li>
