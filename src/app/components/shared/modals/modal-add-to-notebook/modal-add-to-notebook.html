<div class="modal-background" (appEscKey)="close.emit()">
  <div class="modal-container" (clickOutside)="close.emit()">
    @if (note) {
    <div class="header-title-container">
      <h2>Add this note to notebook</h2>
    </div>
    }

    <div class="note-preview-container">
      @if (note) {
      <div class="note-preview" [ngStyle]="{'background-color': note.color}">
        <h4>{{ note.title }}</h4>
        <p class="note-content-preview">{{ note.content | slice:0:100 }} ...</p>
      </div>
      }
    </div>

    <div class="notebooks-section">
      <h6>Select a notebook</h6>

      @if ((notebooks$ | async)!.length > 5) {
      <div class="search-notebooks">
        <div class="search-container">
          <div class="search-input-wrapper">
            <i class="bi bi-search search-icon"></i>
            <input
              type="text"
              [(ngModel)]="searchTerm"
              (ngModelChange)="onSearchChange($event)"
              placeholder="Search notebooks"
              class="search-input"
            />
          </div>
        </div>
      </div>
      } @if ((filteredNotebooks$ | async)!.length > 0) {
      <ul class="notebook-list">
        @for (notebook of filteredNotebooks$ | async; track notebook.id) {
        <li
          (click)="!notebookContainsNote(notebook) && selectNotebook(notebook)"
          class="notebook-item"
          [class.already-contains]="notebookContainsNote(notebook)"
          [class.disabled]="notebookContainsNote(notebook)"
        >
          <div class="notebook-info">
            <iconify-icon icon="noto-v1:notebook"></iconify-icon>
            <p class="notebook-name">{{ notebook.name }}</p>
          </div>

          @if (notebookContainsNote(notebook)) {
          <div class="notebook-status">
            <iconify-icon
              icon="lets-icons:check-fill"
              class="check-icon"
            ></iconify-icon>
            <span>Added</span>
          </div>
          }
        </li>
        }
      </ul>
      } @else {
      <div class="empty-state">
        <p>No notebooks found.</p>

        <button (click)="openCreateNotebook()" class="link-button">
          Create one
        </button>
      </div>
      }
    </div>
  </div>
</div>
