<div class="notebook-detail-container">
  <!-- Loading state -->
  <div class="loading-state" *ngIf="!(notebook$ | async) && !notFound">
    <i class="bi bi-arrow-clockwise"></i>
    Loading notebook...
  </div>

  <!-- Main notebook content -->
  <div class="notebook-detail" *ngIf="notebook$ | async as notebook">
    <!-- Header -->
    <div class="notebook-header">
      <div class="notebook-info">
        <div class="notebook-info-items">
          <h1 class="notebook-title">{{ notebook.name }}</h1>
          <h2 class="section-title">
            {{ notebook.notes.length }} {{ notebook.notes.length <= 1 ? 'NOTE' :
            'NOTES' }}
          </h2>
        </div>

        <div class="notebook-actions">
          <app-button-feature
            customClass="notebook-action-button"
            icon="fluent:edit-28-regular"
            title="Edit Notebook"
            (clicked)="editNotebook(notebook)"
          ></app-button-feature>

          <app-button-feature
            customClass="notebook-action-button"
            icon="mage:trash"
            title="Delete Notebook"
            (clicked)="deleteNotebook(notebook)"
          ></app-button-feature>

          <button
            class="notebook-close-button"
            title="Close Notebook"
            (click)="navigateBack()"
          >
            <i class="bi bi-x-lg"></i>
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Empty state for notebook with no notes -->
    <div class="empty-state" *ngIf="notebook.notes.length === 0">
      <div class="empty-icon">
        <i class="bi bi-journal-x" style="font-size: 3rem; color: #ccc"></i>
      </div>
      <h2>This notebook is empty</h2>
      <p>Add some notes to this notebook to get started!</p>
    </div>

    <!-- Empty state for search with no results -->
    <div
      class="empty-state"
      *ngIf="notebook.notes.length > 0 && 
                                     (searchTerm$ | async) && 
                                     (searchTerm$ | async)!.trim().length > 0 &&
                                     !(hasPinnedNotesInNotebook$ | async) && 
                                     !(hasUnpinnedNotesInNotebook$ | async)"
    >
      <div class="empty-icon">
        <i class="bi bi-search" style="font-size: 3rem; color: #ccc"></i>
      </div>
      <h2>No notes found</h2>
      <p>
        No notes in this notebook match your search for "<strong
          >{{ searchTerm$ | async }}</strong
        >"
      </p>
    </div>

    <!-- Content sections when notebook has notes -->
    <div
      class="content-sections"
      *ngIf="(hasPinnedNotesInNotebook$ | async) || 
                                          (hasUnpinnedNotesInNotebook$ | async)"
    >
      <!-- PINNED NOTES Section -->
      <div class="section" *ngIf="hasPinnedNotesInNotebook$ | async">
        <div class="section-header">
          <h2 class="section-title">PINNED</h2>
        </div>

        <div class="notes-grid">
          <app-note
            *ngFor="let note of (pinnedNotesInNotebook$ | async); trackBy: trackByNoteId"
            [note]="note"
            [showNotebook]="false"
            (open)="openNote($event)"
            (delete)="deleteNote($event)"
            (removeFromNotebook)="removeNoteFromNotebook($event)"
            (togglePin)="togglePin($event.note, $event.event)"
          >
          </app-note>
        </div>
      </div>

      <!-- UNPINNED NOTES Section -->
      <div class="section" *ngIf="hasUnpinnedNotesInNotebook$ | async">
        <div class="section-header">
          <h2 class="section-title">
            {{ (hasPinnedNotesInNotebook$ | async) ? 'OTHER NOTES' : 'YOUR
            NOTES' }}
          </h2>
        </div>

        <div class="notes-grid">
          <app-note
            *ngFor="let note of (unpinnedNotesInNotebook$ | async); trackBy: trackByNoteId"
            [note]="note"
            [showNotebook]="false"
            (open)="openNote($event)"
            (delete)="deleteNote($event)"
            (removeFromNotebook)="removeNoteFromNotebook($event)"
            (togglePin)="togglePin($event.note, $event.event)"
          >
          </app-note>
        </div>
      </div>
    </div>
  </div>
</div>
