<div class="notebook-detail-container">
  <!-- Loading state -->
  @if (!(notebook$ | async) && !notFound) {
  <div class="loading-state">
    <i class="bi bi-arrow-clockwise"></i>
    Loading notebook...
  </div>
  }

  <!-- Main notebook content -->
  @if (notebook$ | async; as notebook) {
  <div class="notebook-detail">
    <!-- Header -->
    <div class="notebook-header">
      <div class="notebook-info">
        <div class="notebook-info-items">
          <h1 class="notebook-title">{{ notebook.name }}</h1>
          <h2 class="note-count">
            {{ notebook.notes.length }} {{ notebook.notes.length <= 1 ? 'NOTE' :
            'NOTES' }}
          </h2>
        </div>

        <div class="notebook-actions">
          <app-button-feature
            customClass="notebook-action-button"
            icon="fluent:edit-28-regular"
            title="Edit Notebook Title"
            (clicked)="editNotebook(notebook)"
          ></app-button-feature>

          <app-button-feature
            customClass="notebook-action-button"
            icon="mage:trash"
            title="Delete Notebook"
            (clicked)="deleteNotebook(notebook)"
          ></app-button-feature>

          <button
            class="notebook-close-button"
            title="Close Notebook"
            (click)="navigateBack()"
            icon="fluent:notebook-section-arrow-right-20-regular"
          >
            <i class="bi bi-x-lg"></i>
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Empty state for notebook with no notes -->
    @if (notebook.notes.length === 0) {
    <div class="empty-state">
      <div class="empty-icon">
        <i class="bi bi-journal-x" style="font-size: 3rem; color: #ccc"></i>
      </div>
      <h2>This notebook is empty</h2>
      <p>Add some notes to this notebook to get started!</p>
    </div>
    }

    <!-- Empty state for search with no results -->
    @if (notebook.notes.length > 0 && (searchTerm$ | async) && (searchTerm$ |
    async)!.trim().length > 0 && !(hasPinnedNotesInNotebook$ | async) &&
    !(hasUnpinnedNotesInNotebook$ | async)) {
    <div class="empty-state">
      <div class="empty-icon">
        <i class="bi bi-search" style="font-size: 3rem; color: #ccc"></i>
      </div>
      <h2>No notes found</h2>
      <p>
        No notes in this notebook match your search for "<strong
          >{{ searchTerm$ | async }}</strong
        >"
      </p>
    </div>
    }

    <!-- Content sections when notebook has notes -->
    @if ((hasPinnedNotesInNotebook$ | async) || (hasUnpinnedNotesInNotebook$ |
    async)) {
    <div class="content-sections">
      <!-- PINNED NOTES Section -->
      @if (hasPinnedNotesInNotebook$ | async) {
      <div class="section">
        <div class="section-header">
          <h2 class="section-title">PINNED</h2>
        </div>

        <div class="notes-grid">
          @for (note of (pinnedNotesInNotebook$ | async); track trackByNoteId(i,
          note); let i = $index) {
          <app-note
            [note]="note"
            [showNotebook]="false"
            (open)="openNote($event)"
            (delete)="deleteNote($event)"
            (removeFromNotebook)="removeNoteFromNotebook($event)"
            (togglePin)="togglePin($event.note, $event.event)"
          >
          </app-note>
          }
        </div>
      </div>
      }

      <!-- UNPINNED NOTES Section -->
      @if (hasUnpinnedNotesInNotebook$ | async) {
      <div class="section">
        <div class="section-header">
          <h2 class="section-title">
            {{ (hasPinnedNotesInNotebook$ | async) ? 'OTHER NOTES' : 'YOUR
            NOTES' }}
          </h2>
        </div>

        <div class="notes-grid">
          @for (note of (unpinnedNotesInNotebook$ | async); track
          trackByNoteId(i, note); let i = $index) {
          <app-note
            [note]="note"
            [showNotebook]="false"
            (open)="openNote($event)"
            (delete)="deleteNote($event)"
            (removeFromNotebook)="removeNoteFromNotebook($event)"
            (togglePin)="togglePin($event.note, $event.event)"
          >
          </app-note>
          }
        </div>
      </div>
      }
    </div>
    }
  </div>
  }
</div>
