<div class="all-view">
  <!-- Loading -->
  @if (isLoading$ | async) {
  <div class="loading-state">
    <i class="bi bi-arrow-clockwise"></i>
    Loading your content...
  </div>
  }

  <!-- No content at all -->
  @if (!(isLoading$ | async) && !(hasNotes$ | async) && !(hasNotebooks$ |
  async)) {
  <div class="empty-state">
    <div class="empty-icon">
      <i class="bi bi-chat-quote" style="font-size: 3rem; color: #ccc"></i>
    </div>

    <h2>Welcome to Noteboard!</h2>
    <p>Start by creating your first note or notebook.</p>
  </div>
  }

  <!-- No search results -->
  @if (!(isLoading$ | async) && searchTerm && (filteredNotes$ | async)?.length
  === 0 && (filteredNotebooks$ | async)?.length === 0) {
  <div class="empty-state">
    <div class="empty-icon">
      <i class="bi bi-search" style="font-size: 3rem; color: #ccc"></i>
    </div>

    <h3>No results found</h3>

    <p>No notes or notebooks match "<strong>{{ searchTerm }}</strong>"</p>
  </div>
  }

  <!-- Content sections -->
  @if (!(isLoading$ | async)) {
  <div class="content-sections">
    <!-- NOTEBOOKS Section -->
    @if (filteredNotebooks$ | async; as notebooks) { @if (notebooks.length > 0
    && !selectedNotebook) {
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">NOTEBOOKS</h2>
      </div>

      <div class="notebooks-grid">
        @for (notebook of (filteredNotebooks$ | async); track
        trackByNotebookId(i, notebook); let i = $index) {
        <div class="notebook-card" (click)="openNotebook(notebook)">
          <!-- Back layer - darker folder -->
          <div class="notebook-back"></div>

          <!-- Front layer - lighter notebook cover -->
          <div
            class="notebook-front"
            [class.has-notes]="notebook.notes.length > 0"
            [class.empty]="notebook.notes.length === 0"
          >
            <!-- Notes tab (for added notes to notebook visualization)-->
            <div class="note-tabs">
              <div
                *ngFor="let note of notebook.notes.slice(0, 8); let i = index"
                class="note-tab"
                [ngStyle]="{
      'background-color': note.color || '#ccc',
      'right.px': i * 20
    }"
              ></div>
            </div>

            <div class="notebook-content">
              <div class="notebook-header">
                <iconify-icon
                  icon="fluent:notebook-subsection-24-filled"
                  class="notebook-icon default-icon"
                ></iconify-icon>

                <iconify-icon
                  icon="solar:notebook-minimalistic-bold"
                  class="notebook-icon hover-icon"
                ></iconify-icon>

                <h3 class="notebook-title">{{ notebook.name }}</h3>
              </div>

              <div class="notebook-meta">
                <span class="note-count">
                  {{ notebook.notes.length }} {{ notebook.notes.length <= 1 ?
                  'note' : 'notes' }}
                </span>

                <div
                  class="notebook-actions"
                  (click)="$event.stopPropagation()"
                >
                  <app-button-feature
                    customClass="notebook-action-button"
                    icon="fluent:edit-28-regular"
                    title="Edit Notebook Title"
                    (clicked)="editNotebook(notebook)"
                  ></app-button-feature>

                  <app-button-feature
                    customClass="notebook-action-button"
                    icon="mage:trash"
                    title="Delete Notebook"
                    (clicked)="deleteNotebook(notebook.id)"
                  ></app-button-feature>
                </div>
              </div>
            </div>
          </div>
        </div>
        }
      </div>
    </div>
    }

    <!-- PINNED NOTES Section -->
    @if ((hasPins$ | async) && !selectedNotebook) {
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">PINNED</h2>
      </div>

      <div class="notes-grid">
        @for (note of (pinnedNotes$ | async); track trackByNoteId(i, note); let
        i = $index) {
        <app-note
          [note]="note"
          (open)="openNoteModal($event)"
          (delete)="deleteNote($event)"
          (togglePin)="togglePin($event.note, $event.event)"
          (imageUpload)="handleImageUpload($event)"
          (triggerEdit)="openNoteModal($event)"
        >
        </app-note>
        }
      </div>
    </div>
    }

    <!-- ALL NOTES Section -->
    @if ((hasUnpinnedNotes$ | async) && !selectedNotebook) {
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">NOTES</h2>
      </div>

      <div class="notes-grid">
        @for (note of (filteredNotes$ | async); track trackByNoteId(i, note);
        let i = $index) {

        <app-note
          [note]="note"
          (open)="openNoteModal($event)"
          (delete)="deleteNote($event)"
          (togglePin)="togglePin($event.note, $event.event)"
          (imageUpload)="handleImageUpload($event)"
          (triggerEdit)="openNoteModal($event)"
        >
        </app-note>
        }
      </div>
    </div>
    } }
  </div>
  }
</div>
