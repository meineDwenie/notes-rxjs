<div class="all-view">
  <!-- Loading -->
  <div *ngIf="isLoading$ | async">Loading the notes ...</div>

  <!-- No notes -->
  <div
    *ngIf="!(isLoading$ | async) && !(hasNotes$ | async)"
    class="empty-state"
  >
    <p><i class="bi bi-emoji-frown me-2"></i>No notes yet. Add one!</p>
  </div>

  <!-- No notes match search -->
  <div
    *ngIf="!(isLoading$ | async) 
        && (filteredNotes$ | async)?.length === 0 
        && (pinnedNotes$ | async) 
        && (filteredNotebooks$ | async )?.length ===0
        && searchTerm"
    class="empty-state"
  >
    <p>
      <i class="bi bi-search me-2"></i>No notes match your search "<strong
        >{{ searchTerm }}</strong
      >"
    </p>
  </div>

  <!-- Light Blue secondary background -->
  <div class="secondary-background"></div>

  <!-- MY NOTEBOOKS -->
  <div class="section" *ngIf="hasNotebooks$ | async">
    <h3 class="section-title">MY NOTEBOOKS</h3>

    <div class="notebooks-row" id="notebooksContainer">
      <div class="notebook-item" *ngFor="let notebook of (notebooks$ | async)">
        <!-- Notebook box -->
        <div class="notebook-box">
          <!-- Notebook Header (Clickable) -->
          <div class="notebook-header" (click)="selectNotebook(notebook)">
            <iconify-icon icon="emojione-v1:notebook"></iconify-icon>
            <h3>{{ notebook.name }}</h3>
          </div>

          <!-- Three-dots Button -->
          <button
            class="ntbk-three-dots"
            (click)="toggleNotebookOptions(notebook.id); $event.stopPropagation()"
          >
            <i class="bi bi-three-dots-vertical"></i>
          </button>

          <!-- Dropdown menu -->
          <div
            class="dropdown-menu"
            *ngIf="openNotebookOptionsId === notebook.id"
            (click)="$event.stopPropagation()"
          >
            <button (click)="startEditingNotebook(notebook)">Edit</button>
            <button (click)="deleteNotebook(notebook.id)">Delete</button>
          </div>

          <!-- Note count & date -->
          <div class="notebook-meta">
            <div class="ntbk-note-count">{{ notebook.notes.length }} notes</div>
            <div class="ntbk-date-added">
              {{ notebook.createdAt | date: 'MM/dd/yyyy' }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notes in selected notebook -->
  <div class="section" *ngIf="selectedNotebook">
    <h3 class="section-title">NOTES IN "{{ selectedNotebook.name }}"</h3>

    <div class="notes-grid">
      <div
        class="note-item"
        *ngFor="let note of selectedNotebook.notes"
        [style.backgroundColor]="note.color || '#ffffff'"
        (click)="openNoteModal(note)"
      >
        <div class="pin-icon" (click)="togglePin(note, $event)">
          <i class="bi" [ngClass]="note.pinned ? 'bi-pin-fill' : 'bi-pin'"></i>
        </div>

        <h3 class="note-title">{{ note.title }}</h3>
        <div class="note-content">{{ note.content }}</div>

        <div class="note-images" *ngIf="note.images?.length">
          <img
            *ngFor="let img of note.images"
            [src]="img"
            alt="Note image"
            class="note-image"
          />
        </div>
      </div>
    </div>
  </div>

  <!-- MY PINS ------------------------------------------------>
  <div class="section" *ngIf="hasPins$ | async">
    <h3 class="section-title">MY PINS</h3>

    <ul>
      <li
        *ngFor="let pinnedNote of pinnedNotes$ | async"
        [style.backgroundColor]="pinnedNote.color || '#ffffff'"
        (click)="openNoteModal(pinnedNote)"
      >
        <div>
          <h3 class="note-title">{{ pinnedNote.title }}</h3>

          <p>{{ pinnedNote.content }}</p>

          <!-- Thumbnails with delete buttons -->
          <div class="image-preview" *ngIf="pinnedNote.images?.length">
            <div class="image-wrapper" *ngFor="let img of pinnedNote.images">
              <img [src]="img" class="preview-thumbnail" />
            </div>
          </div>
        </div>

        <!-- Buttons -->
        <div class="buttons-container" (click)="$event.stopPropagation()">
          <!-- <button (click)="editNote(pinnedNote)" title="Edit">
              <i class="bi bi-pencil"></i>
              Edit
            </button> -->

          <button (click)="deleteNote(pinnedNote.id)" title="Delete">
            <i class="bi bi-trash-fill"></i>
            Delete
          </button>

          <!-- Pin icon just to the right of the title -->
          <i
            class="bi bi-pin-fill pin-icon"
            title="Unpin"
            (click)="togglePin(pinnedNote, $event)"
          ></i>
        </div>
      </li>
    </ul>
  </div>

  <!-- RECENT NOTE(S) -------------------------------------------->
  <div class="section" *ngIf="hasUnpinnedNotes$ | async">
    <h3 class="section-title">RECENT NOTES</h3>
    <ul>
      <li
        *ngFor="let note of (filteredNotes$ | async)"
        [style.backgroundColor]="note.color || '#ffffff'"
        (click)="openNoteModal(note)"
      >
        <div>
          <h3 class="note-title">{{ note.title }}</h3>

          <p>{{ note.content }}</p>

          <!-- Thumbnails with delete buttons -->
          <div class="image-preview" *ngIf="note.images?.length">
            <div class="image-wrapper" *ngFor="let img of note.images">
              <img [src]="img" class="preview-thumbnail" />
            </div>
          </div>
        </div>

        <!-- Buttons -->
        <div class="buttons-container" (click)="$event.stopPropagation()">
          <!-- <button (click)="editNote(note)" title="Edit">
              <i class="bi bi-pencil"></i>
              Edit
            </button> -->

          <button (click)="deleteNote(note.id)" title="Delete">
            <i class="bi bi-trash-fill"></i>
            Delete
          </button>

          <!-- pin icon -->
          <div class="pin-icon">
            <i
              class="bi"
              [ngClass]="note.pinned ? 'bi-pin-fill' : 'bi-pin'"
              title="{{ note.pinned ? 'Unpin' : 'Pin' }}"
              (click)="togglePin(note, $event)"
            ></i>
          </div>
        </div>
      </li>
    </ul>
  </div>
</div>
