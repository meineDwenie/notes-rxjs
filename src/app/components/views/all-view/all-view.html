<div class="all-view">
  <!-- Loading -->
  <div *ngIf="isLoading$ | async" class="loading-state">
    <i class="bi bi-arrow-clockwise"></i>
    Loading your content...
  </div>

  <!-- No content at all -->
  <div
    *ngIf="!(isLoading$ | async) && !(hasNotes$ | async) && !(hasNotebooks$ | async)"
    class="empty-state"
  >
    <iconify-icon
      icon="fluent:notebook-add-20-regular"
      class="empty-icon"
    ></iconify-icon>
    <h3>Welcome to Noteboard!</h3>
    <p>Start by creating your first note or notebook</p>
    <div class="empty-actions">
      <button (click)="createNewNote()" class="primary-button">
        <iconify-icon icon="fluent:note-add-16-regular"></iconify-icon>
        Create Note
      </button>
      <button (click)="createNewNotebook()" class="secondary-button">
        <iconify-icon icon="fluent:notebook-add-20-regular"></iconify-icon>
        Create Notebook
      </button>
    </div>
  </div>

  <!-- No search results -->
  <div
    *ngIf="!(isLoading$ | async) && searchTerm && 
           (filteredNotes$ | async)?.length === 0 && 
           (filteredNotebooks$ | async)?.length === 0"
    class="empty-state"
  >
    <iconify-icon icon="bi:search" class="empty-icon"></iconify-icon>
    <h3>No results found</h3>
    <p>No notes or notebooks match "<strong>{{ searchTerm }}</strong>"</p>
    <button (click)="clearSearch()" class="secondary-button">
      Clear search
    </button>
  </div>

  <!-- Content sections -->
  <div class="content-sections" *ngIf="!(isLoading$ | async)">
    <!-- NOTEBOOKS Section -->
    <div class="section" *ngIf="(hasNotebooks$ | async) && !selectedNotebook">
      <div class="section-header">
        <h2 class="section-title">
          <iconify-icon icon="hugeicons:notebook-01"></iconify-icon>
          NOTEBOOKS
        </h2>
        <span class="section-count">({{ (notebooks$ | async)?.length }})</span>
      </div>

      <div class="notebooks-grid">
        <div
          class="notebook-card"
          *ngFor="let notebook of (filteredNotebooks$ | async); trackBy: trackByNotebookId"
          (click)="openNotebook(notebook)"
        >
          <div class="notebook-header">
            <iconify-icon
              icon="fluent:notebook-subsection-24-filled"
              class="notebook-icon"
            >
            </iconify-icon>
            <h3 class="notebook-title">{{ notebook.name }}</h3>
          </div>

          <div class="notebook-meta">
            <span class="note-count">{{ notebook.notes.length }} notes</span>
            <span class="created-date"
              >{{ notebook.createdAt | date:'shortDate' }}</span
            >
          </div>

          <div class="notebook-actions" (click)="$event.stopPropagation()">
            <button (click)="editNotebook(notebook)" title="Edit">
              <iconify-icon icon="fluent:edit-12-regular"></iconify-icon>
            </button>
            <button (click)="deleteNotebook(notebook.id)" title="Delete">
              <iconify-icon icon="ph:trash"></iconify-icon>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- PINNED NOTES Section -->
    <div class="section" *ngIf="(hasPins$ | async) && !selectedNotebook">
      <div class="section-header">
        <h2 class="section-title">
          <iconify-icon icon="bi:pin-fill"></iconify-icon>
          PINNED
        </h2>
        <span class="section-count"
          >({{ (pinnedNotes$ | async)?.length }})</span
        >
      </div>

      <div class="notes-grid">
        <app-note
          *ngFor="let note of (pinnedNotes$ | async); trackBy: trackByNoteId"
          [note]="note"
          (open)="openNoteModal($event)"
          (delete)="deleteNote($event)"
          (togglePin)="togglePin($event.note, $event.event)"
          (optionSelected)="handleNoteOptionSelected($event, note)"
        >
        </app-note>
      </div>
    </div>

    <!-- ALL NOTES Section -->
    <div
      class="section"
      *ngIf="(hasUnpinnedNotes$ | async) && !selectedNotebook"
    >
      <div class="section-header">
        <h2 class="section-title">
          <iconify-icon icon="fluent:note-48-regular"></iconify-icon>
          NOTES
        </h2>
        <span class="section-count"
          >({{ (filteredNotes$ | async)?.length }})</span
        >
      </div>

      <div class="notes-grid">
        <app-note
          *ngFor="let note of (filteredNotes$ | async); trackBy: trackByNoteId"
          [note]="note"
          (open)="openNoteModal($event)"
          (delete)="deleteNote($event)"
          (togglePin)="togglePin($event.note, $event.event)"
          (optionSelected)="handleNoteOptionSelected($event, note)"
        >
        </app-note>
      </div>
    </div>
  </div>
</div>
